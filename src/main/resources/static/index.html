<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Sensor Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f4f6f8;
        }
        h1 {
            color: #333;
        }
        section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin: 8px 0 4px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            width: 250px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            margin-top: 10px;
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background: #222;
            color: #0f0;
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

<h1>üå¶Ô∏è Weather Sensor Dashboard</h1>

<section>
    <h2>Add Sensor Reading</h2>
    <label for="sensorId">Sensor ID:</label>
    <input id="sensorId" type="text" value="1"/>

    <label for="metric">Metric:</label>
    <input id="metric" type="text" value="temperature"/>

    <label for="value">Value:</label>
    <input id="value" type="number" step="0.01" value="25.5"/>

    <button onclick="addReading()">Add Reading</button>

    <h3>Response:</h3>
    <pre id="addResponse"></pre>
</section>

<section>
    <h2>Query Sensor Data</h2>
    <label for="querySensorId">Sensor ID (or blank for all):</label>
    <input id="querySensorId" type="text" />

    <label for="queryMetric">Metric (e.g., temperature, humidity):</label>
    <input id="queryMetric" type="text" />

    <label for="statistic">Statistic:</label>
    <select id="statistic">
        <option value="avg">Average</option>
        <option value="min">Minimum</option>
        <option value="max">Maximum</option>
        <option value="sum">Sum</option>
    </select>

    <label for="days">Days Back (optional):</label>
    <input id="days" type="number" placeholder="e.g. 7"/>

    <button onclick="queryReadings()">Run Query</button>

    <h3>Response:</h3>
    <pre id="queryResponse"></pre>
</section>

<script>
    async function addReading() {
        const reading = {
            sensorId: document.getElementById('sensorId').value,
            metric: document.getElementById('metric').value,
            value: parseFloat(document.getElementById('value').value),
            timestamp: new Date().toISOString()
        };

        try {
            const res = await fetch(`/api/sensors/${reading.sensorId}/readings`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(reading)
            });
            const data = await res.json();
            document.getElementById('addResponse').textContent = JSON.stringify(data, null, 2);
        } catch (err) {
            document.getElementById('addResponse').textContent = err;
        }
    }

    async function queryReadings() {
        const params = new URLSearchParams();
        const sensorId = document.getElementById('querySensorId').value;
        const metric = document.getElementById('queryMetric').value;
        const stat = document.getElementById('statistic').value;
        const days = document.getElementById('days').value;

        if (sensorId) params.append("sensorId", sensorId);
        if (metric) params.append("metric", metric);
        if (stat) params.append("statistic", stat);
        if (days) params.append("days", days);

        try {
            const res = await fetch(`/api/sensors/query?${params.toString()}`);
            const data = await res.json();
            document.getElementById('queryResponse').textContent = JSON.stringify(data, null, 2);
        } catch (err) {
            document.getElementById('queryResponse').textContent = err;
        }
    }
</script>

</body>
</html>
